# H.264 编码中的帧
## 导言
高级视频编码 (AVC) 也称为 H.264，是使用最广泛的视频压缩标准。它与所有主要的流式传输协议和容器格式兼容。
当我们使用播放器播放一个视频时，通常会经过：解协议，解封装，音视频解码，音视频同步这几个步骤。其中H.264就是视频解码阶段的标准。通过解封装，可以将数据解析为H.264格式的数据流，通过解码，可以将H.264格式的数据流输出为非压缩的颜色数据，如YUV，RGB等。
![](img/h264uml.png)

## 视频帧
在视频编码中，视频由一系列连续的图像帧组成。每一帧都代表视频中的一个瞬间图像，而它们之间存在特定的关系。
### I帧
关键帧是视频序列中的关键参考点，它是独立编码的帧，不依赖于其他帧。
关键帧包含完整的信息，可以独立解码出网站的图像。基于其特性，播放器在进行快进操作时，一般都会跳转到I帧，确保在该关键帧之后的播放过程中可以正常解码和显示视频。这样可以有效减少解码所需的计算量，提高快进操作的响应速度。
### P帧
预测帧是相对于关键帧的帧，它通过对前面的关键帧或预测帧进行预测来编码。
P帧相对于I帧具有较小的文件大小，因为它只存储相对于参考帧的差异信息。但是在进行解码时，P帧也需要依赖之前的帧进行解码。
### B帧
双向预测帧引入了更复杂的预测方式，利用前后的关键帧和预测帧进行双向预测。
相对于关键帧（I 帧）和预测帧（P 帧）具有更高的压缩效率和更复杂的结构，适当的引入B帧可以显著的较小视频文件的大小，提升视频的传输效率。
### 帧解码和播放顺序
由于一个视频文件中可能存在I，B，P三种不同的视频帧，所以帧的解码和播放顺序可能会不同。在H.264中，有两个时间戳，一个是PTS，一个是DTS：
- PTS（Presentation Time Stamp）：
    - PTS 表示视频帧应该被展示的时间。它指示视频帧何时应该在播放器中显示给用户。
    - PTS 的时间单位通常是毫秒（ms）或时钟周期，取决于具体的应用和实现。
    - PTS 的值不仅受到帧自身的编码时间影响，还受到解码和显示的延迟等因素的影响。
- DTS（Decoding Time Stamp）：
    - DTS 表示视频帧应该被解码的时间。它指示视频帧何时应该被送入解码器进行解码。
    - 与 PTS 不同，DTS 主要关注解码过程，而不是展示过程。
    - 在一些情况下，视频帧的 DTS 可能等于其 PTS，但在其他情况下可能存在差异，这取决于编码和解码过程中的各种因素。

在视频中没有B帧时，视频的解码顺序和播放顺序如下：
```
Stream: I P P P P P P 
   PTS: 1 2 3 4 5 6 7
   DTS: 1 2 3 4 5 6 7
```
在视频中存在B帧时，视频的解码顺序和播放顺序如下：
```
Stream: I B B P B B P
   PTS: 1 2 3 4 5 6 7
   DTS: 1 3 4 2 6 7 5
```
## GOP

## IDR